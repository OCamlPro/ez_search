<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>EzSearch (ez_search.Ez_search.V1.EzSearch)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">ez_search</a> &#x00BB; <a href="../../index.html">Ez_search</a> &#x00BB; <a href="../index.html">V1</a> &#x00BB; EzSearch</nav><header class="odoc-preamble"><h1>Module <code><span>V1.EzSearch</span></code></h1><p>This module implements full-text search with regexps in a set of files. Two steps are required: in the first step, a database is generated from all the files; in the second step, searches are performed in the database.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-TYPES" class="anchored"><a href="#module-TYPES" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="TYPES/index.html">TYPES</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-index_directory" class="anchored"><a href="#val-index_directory" class="anchor"></a><code><span><span class="keyword">val</span> index_directory : <span>db_dir:string <span class="arrow">&#45;&gt;</span></span> <span>?db_name:string <span class="arrow">&#45;&gt;</span></span> <span>select:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
<span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>index_directory ~db_dir ?db_name ~select DIRECTORY</code> index all files in <code>DIRECTORY</code>, and store the index in <code>db_dir</code>. Every top-directory in DIRECTORY is considered as a <code>file_entry</code> name, and <code>file_name</code> are relative paths within top-directories. <code>select</code> takes a path in argument and returns <code>true</code> if the content of the path should be indexed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-load_db" class="anchored"><a href="#val-load_db" class="anchor"></a><code><span><span class="keyword">val</span> load_db : <span>db_dir:string <span class="arrow">&#45;&gt;</span></span> <span>?db_name:string <span class="arrow">&#45;&gt;</span></span> <span>?use_mapfile:bool <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="TYPES/index.html#type-db">TYPES.db</a></span></code></div><div class="spec-doc"><p><code>load_db ~db_dir ?db_name ?use_mapfile ()</code> loads the database in memory. <code>use_mapfile</code> controls whether to use a memory-mapped file or load it normally. Memory-mapped files are normally more efficient, but support may be more unstable.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-count_lines_total" class="anchored"><a href="#val-count_lines_total" class="anchor"></a><code><span><span class="keyword">val</span> count_lines_total : <span>db:<a href="TYPES/index.html#type-db">TYPES.db</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>count_lines_total ~db</code> counts the number of '\n' in the database. Needs some time to iter on the whole text.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-length" class="anchored"><a href="#val-length" class="anchor"></a><code><span><span class="keyword">val</span> length : <span>db:<a href="TYPES/index.html#type-db">TYPES.db</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>length ~db</code> returns the number of chars in the database.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-search" class="anchored"><a href="#val-search" class="anchor"></a><code><span><span class="keyword">val</span> search : <span>db:<a href="TYPES/index.html#type-db">TYPES.db</a> <span class="arrow">&#45;&gt;</span></span> <span>f:<span>(<span><a href="TYPES/index.html#type-occurrence">TYPES.occurrence</a> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span>?pos:int <span class="arrow">&#45;&gt;</span></span> <span>?last:<a href="TYPES/index.html#type-occurrence_file">TYPES.occurrence_file</a> <span class="arrow">&#45;&gt;</span></span> <span>?len:int <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>pos:int <span class="arrow">&#45;&gt;</span></span> <span>len:int <span class="arrow">&#45;&gt;</span></span>
<span>string <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>search ~db ~f ?pos ?last ?len find</code> searches with <code>find</code> in the database, starting either from <code>pos</code>, from after the last occurrence <code>last</code>, or from the beginning. Calls <code>f</code> for every occurrence found. <code>f</code> returns a boolean, that should be <code>true</code> if the search should continue after, or <code>false</code> if the search should terminate immediately. <code>len</code> is the string length to use.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-search_and_count" class="anchored"><a href="#val-search_and_count" class="anchor"></a><code><span><span class="keyword">val</span> search_and_count : <span>db:<a href="TYPES/index.html#type-db">TYPES.db</a> <span class="arrow">&#45;&gt;</span></span> <span>?is_regexp:bool <span class="arrow">&#45;&gt;</span></span> <span>?is_case_sensitive:bool <span class="arrow">&#45;&gt;</span></span>
<span>?ncores:int <span class="arrow">&#45;&gt;</span></span> <span>?maxn:int <span class="arrow">&#45;&gt;</span></span> <span>?find:<span>(<span>pos:int <span class="arrow">&#45;&gt;</span></span> <span>len:int <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
<span>string <span class="arrow">&#45;&gt;</span></span> int * <span><a href="TYPES/index.html#type-occurrence">TYPES.occurrence</a> list</span></span></code></div><div class="spec-doc"><p><code>search_and_count ~db ?is_regexp ?is_case_sensitive ?ncores
     ?maxn ?find term</code> searches <code>term</code> in the database, either using <code>find</code> if provided, or a mix of <code>Str</code> and <code>memmem</code> otherwise (depending on <code>is_regexp</code> and <code>is_case_sensitive</code>). Uses <code>Parmap</code> to split the computation on multiple cores, with at most <code>ncores</code> if provided. Returns a very close approximation of the number of occurrences (exact on 1 core), and a list of at least <code>maxn</code> occurrences.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-occurrence_file" class="anchored"><a href="#val-occurrence_file" class="anchor"></a><code><span><span class="keyword">val</span> occurrence_file : <span>db:<a href="TYPES/index.html#type-db">TYPES.db</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="TYPES/index.html#type-occurrence">TYPES.occurrence</a> <span class="arrow">&#45;&gt;</span></span> <a href="TYPES/index.html#type-occurrence_file">TYPES.occurrence_file</a></span></code></div><div class="spec-doc"><p><code>occurrence_file ~db pos</code> returns the file occurrence of the match.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-occurrence_line" class="anchored"><a href="#val-occurrence_line" class="anchor"></a><code><span><span class="keyword">val</span> occurrence_line : <span>db:<a href="TYPES/index.html#type-db">TYPES.db</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="TYPES/index.html#type-occurrence_file">TYPES.occurrence_file</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>occurrence_line ~db occ</code> returns the line number in the file.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-occurrence_context" class="anchored"><a href="#val-occurrence_context" class="anchor"></a><code><span><span class="keyword">val</span> occurrence_context : <span>db:<a href="TYPES/index.html#type-db">TYPES.db</a> <span class="arrow">&#45;&gt;</span></span> <span>line:int <span class="arrow">&#45;&gt;</span></span> <span><a href="TYPES/index.html#type-occurrence_file">TYPES.occurrence_file</a> <span class="arrow">&#45;&gt;</span></span> <span>max:int <span class="arrow">&#45;&gt;</span></span> <a href="TYPES/index.html#type-occurrence_context">TYPES.occurrence_context</a></span></code></div><div class="spec-doc"><p><code>occurrence_context ~db ~line occ ~max</code> returns the context of the occurrence of in the file. The <code>line</code> number of the occurrence, as provided by <code>occurrence_line</code> should be provided. The parameter <code>max</code> controls how many lines should be returned before and after the occurrence.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-file_content" class="anchored"><a href="#val-file_content" class="anchor"></a><code><span><span class="keyword">val</span> file_content : <span>db:<a href="TYPES/index.html#type-db">TYPES.db</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="TYPES/index.html#type-file">TYPES.file</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>file_content ~db file</code> returns the content of the file, as retrieved from the database.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-files" class="anchored"><a href="#val-files" class="anchor"></a><code><span><span class="keyword">val</span> files : <span>db:<a href="TYPES/index.html#type-db">TYPES.db</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="TYPES/index.html#type-file">TYPES.file</a> array</span></span></code></div><div class="spec-doc"><p><code>files ~db</code> returns all the files stored in the database.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pos" class="anchored"><a href="#val-pos" class="anchor"></a><code><span><span class="keyword">val</span> pos : <span><a href="TYPES/index.html#type-occurrence">TYPES.occurrence</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-text" class="anchored"><a href="#val-text" class="anchor"></a><code><span><span class="keyword">val</span> text : <span>db:<a href="TYPES/index.html#type-db">TYPES.db</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-memmem" class="anchored"><a href="#val-memmem" class="anchor"></a><code><span><span class="keyword">val</span> memmem : <span>haystack:string <span class="arrow">&#45;&gt;</span></span> <span>pos:int <span class="arrow">&#45;&gt;</span></span> <span>len:int <span class="arrow">&#45;&gt;</span></span> <span>needle:string <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-time" class="anchored"><a href="#val-time" class="anchor"></a><code><span><span class="keyword">val</span> time : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span></span></code></div><div class="spec-doc"><p><code>time msg f x</code> prints the time spent executing <code>f x</code>.</p></div></div></div></body></html>